#!/bin/bash
# Physically wipe previously deleted data from disk by filling all free space
# with random data.

file="random.bin"

echo "Writing random data to $file..."
while true; do
    if dd if=/dev/urandom bs=4K count=1024 status=none >> $file; then
        space=$(df -h --output=avail . | tail -1 | tr -d '[:space:]')
        echo -ne "\rSpace left: $space"
    else
        sync
        echo -e "\nNo more space left on device"
        break
    fi
done
echo "Done"

size=$(du -h $file | cut -f 1)
rm -f $file
echo "Removed $file ($size)"
