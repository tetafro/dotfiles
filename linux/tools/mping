#!/bin/bash
# Run tmux with a few gping in separate panes. Ping each IP gateway from
# the routing table and 1.1.1.1 as an indicator for external Internet.

if ! tmux has-session -t main 2>/dev/null; then
    tmux new-session -d -s main
fi

gateways="$(
    ip route | \
    grep -Eo 'via [0-9]+\.[0-9]+\.[0-9]+\.[0-9]+' | \
    cut -d ' ' -f 2 | \
    sort | \
    uniq
)"
i=0
for gw in $gateways; do
    tmux send-keys -t "main:0.$i" "gping --watch-interval 1 --buffer 300 $gw"
    tmux split-window -v -t main
    (( i++ ))
done
tmux send-keys -t "main:0.$i" "gping --watch-interval 1 --buffer 300 1.1.1.1"

tmux select-layout -t main even-vertical
tmux attach-session -t main
